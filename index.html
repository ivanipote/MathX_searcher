<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Megane Learn Premium • Recherche</title>
  <style>
    body {font-family:system-ui,sans-serif; margin:0; background:#f8fbff;}
    .header-logo {position:fixed;top:15px;right:15px;background:white;padding:10px 18px;border-radius:50px;box-shadow:0 6px 25px rgba(0,102,255,0.3);z-index:100;display:flex;align-items:center;gap:10px;}
    .logo-header {width:40px;height:40px;border-radius:12px;}
    .logo-text {color:#0066FF;font-weight:900;font-size:1.3rem;}
    
    .hero {background:linear-gradient(135deg,#0066FF,#0047b3);color:white;text-align:center;padding:90px 20px 60px;}
    h1 {font-size:2.4rem;margin:0 0 15px;}
    p {font-size:1.2rem;opacity:0.95;margin-bottom:30px;}
    
    #searchInput {width:90%;max-width:720px;padding:22px 30px;font-size:1.7rem;border:none;border-radius:50px;outline:none;box-shadow:0 15px 40px rgba(0,102,255,0.4);}
    
    #status {
      margin:30px auto;
      padding:18px 30px;
      font-size:1.4rem;
      font-weight:bold;
      border-radius:50px;
      max-width:600px;
      display:inline-block;
    }
    .status-success {background:#e6f7ee; color:#006400; border:3px solid #00c853;}
    .status-error   {background:#ffebee; color:#c62828; border:3px solid #f44336;}
    
    #resultCount {margin:20px 0;font-size:1.6rem;color:#0066FF;font-weight:bold;}
    
    .results {display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:25px;padding:20px;max-width:1400px;margin:0 auto;}
    .card {background:white;border-radius:20px;padding:25px;box-shadow:0 10px 35px rgba(0,102,255,0.15);transition:.3s;text-align:center;}
    .card:hover {transform:translateY(-12px);box-shadow:0 25px 60px rgba(0,102,255,0.25);}
    .file-name {font-size:1.4rem;color:#0066FF;font-weight:bold;margin:15px 0;word-break:break-all;}
    mark {background:#ffeb3b;color:#000;padding:2px 6px;border-radius:6px;font-weight:bold;}
    .btn {background:#0066FF;color:white;padding:14px 35px;border-radius:50px;text-decoration:none;font-weight:bold;display:inline-block;margin:10px 0;}
    .btn:hover {background:#0047b3;}
    
    .bottom-nav {position:fixed;bottom:0;width:100%;background:white;display:flex;justify-content:space-around;padding:18px 0;box-shadow:0 -8px 30px rgba(0,0,0,0.1);font-weight:bold;}
    .bottom-nav a.active {color:#0066FF;font-weight:900;}
  </style>
</head>
<body>

  <div class="header-logo">
    <img src="logo.png" alt="Megane Learn" class="logo-header">
    <span class="logo-text">Megane Learn</span>
  </div>

  <div class="hero">
    <h1>Recherche Premium Ultra-Rapide</h1>
    <p>Tous vos fichiers PDF, images, documents — trouvés instantanément</p>
    <input type="text" id="searchInput" placeholder="Tapez : math, voiture, snapchat, cours..." autofocus>
    
    <!-- Message de statut -->
    <div id="status">Connexion au dépôt...</div>
    
    <div id="resultCount"></div>
  </div>

  <div class="results" id="results"></div>

  <nav class="bottom-nav">
    <a href="index.html">ACCUEIL</a>
    <a href="rech.html" class="active">RECHERCHE</a>
    <a href="pro.html">PRO</a>
    <a href="guide.html">GUIDE</a>
  </nav>

  <script type="module">
    const REPO = "ivanipote/premium_search";
    const FOLDER = "searchfiles";
    let files = [];

    const statusEl = document.getElementById("status");

    async function loadFiles() {
      try {
        const res = await fetch(`https://api.github.com/repos/\( {REPO}/contents/ \){FOLDER}`);
        
        if (!res.ok) {
          throw new Error("Dossier non trouvé");
        }

        const data = await res.json();

        files = data
          .filter(f => f.type === "file")
          .map(f => ({
            name: f.name,
            url: f.download_url,
            size: f.size
          }))
          .sort((a, b) => a.name.localeCompare(b.name));

        // SUCCESS : message vert
        statusEl.textContent = `${files.length} fichiers trouvés – recherche activée !`;
        statusEl.className = "status-success";
        
        showAll();
      } catch (error) {
        // ERROR : message rouge
        statusEl.innerHTML = `Erreur : dossier "<strong>searchfiles</strong>" introuvable`;
        statusEl.className = "status-error";
        document.getElementById("searchInput").disabled = true;
        document.getElementById("searchInput").placeholder = "Dossier manquant";
        console.error("Dossier non trouvé :", error);
      }
    }

    function highlightName(name, terms) {
      let highlighted = name;
      terms.forEach(term => {
        const regex = new RegExp(`(${term})`, 'gi');
        highlighted = highlighted.replace(regex, '<mark>$1</mark>');
      });
      return highlighted;
    }

    function showAll() {
      const container = document.getElementById("results");
      container.innerHTML = "";
      files.forEach(file => {
        container.innerHTML += `
          <div class="card">
            <div class="file-name">${file.name}</div>
            <a href="${file.url}" download class="btn">Télécharger</a>
          </div>
        `;
      });
      document.getElementById("resultCount").textContent = `${files.length} fichiers disponibles`;
    }

    function search(query) {
      const terms = query.toLowerCase().trim().split(/\s+/).filter(t => t.length > 1);
      if (terms.length === 0) return showAll();

      const matches = files.filter(file =>
        terms.every(term => file.name.toLowerCase().includes(term))
      );

      const container = document.getElementById("results");
      container.innerHTML = "";
      matches.forEach(file => {
        container.innerHTML += `
          <div class="card">
            <div class="file-name">${highlightName(file.name, terms)}</div>
            <a href="${file.url}" download class="btn">Télécharger</a>
          </div>
        `;
      });

      document.getElementById("resultCount").textContent = 
        matches.length ? `\( {matches.length} résultat \){matches.length > 1 ? 's' : ''}` : "Aucun fichier trouvé";
    }

    // Recherche fluide
    let timer;
    document.getElementById("searchInput").addEventListener("input", e => {
      clearTimeout(timer);
      timer = setTimeout(() => search(e.target.value), 350);
    });

    // Démarrage
    loadFiles();
  </script>
</body>
  </html>
