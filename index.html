<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recherche Intelligente ‚Ä¢ Megane Learn</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.worker.min.js"></script>
  <style>
    /* === STYLES G√âN√âRAUX === */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f9ff 0%, #e8f2ff 100%);
      min-height: 100vh;
    }

    /* === LOGO HEADER CENTR√â - PLUS COMPACT === */
    .header-center {
      text-align: center;
      padding: 20px 20px 15px;
      background: white;
      box-shadow: 0 2px 15px rgba(0,102,255,0.08);
    }

    .logo-container {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      background: white;
      padding: 10px 25px;
      border-radius: 40px;
      border: 3px solid #0066FF;
      box-shadow: 0 4px 20px rgba(0,102,255,0.15);
    }

    .logo-header {
      height: 35px;
      width: auto;
    }

    .logo-text {
      font-size: 1.5rem;
      font-weight: bold;
      color: #0066FF;
      letter-spacing: -0.3px;
    }

    /* === BARRE DE NAVIGATION STYLIS√âE === */
    .nav-container {
      background: #0066FF;
      padding: 6px;
      border-radius: 40px;
      margin: 15px auto 20px;
      max-width: 500px;
      box-shadow: 0 6px 25px rgba(0,102,255,0.25);
      border: 2px solid #0055DD;
    }

    .bottom-nav {
      display: flex;
      justify-content: center;
      gap: 4px;
      padding: 4px;
    }

    .bottom-nav a {
      flex: 1;
      text-align: center;
      padding: 12px 20px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95rem;
      border-radius: 35px;
      transition: all 0.3s ease;
      background: transparent;
      border: 2px solid transparent;
    }

    .bottom-nav a:hover {
      background: rgba(255,255,255,0.15);
      transform: translateY(-1px);
    }

    .bottom-nav a.active {
      background: white;
      color: #0066FF;
      box-shadow: 0 4px 15px rgba(0,102,255,0.3);
      border: 2px solid #0055DD;
    }

    /* === ZONE DE RECHERCHE - STYLE CHROME === */
    .search-container {
      text-align: center;
      padding: 25px 20px 20px;
    }

    .search-container h1 {
      color: #0066FF;
      font-size: 1.4rem;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .search-wrapper {
      position: relative;
      display: inline-block;
      width: 92%;
      max-width: 600px;
    }

    #searchInput {
      width: 100%;
      padding: 14px 50px 14px 45px;
      font-size: 1.1rem;
      border: 2px solid #dfe1e5;
      border-radius: 30px;
      outline: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: white;
      box-sizing: border-box;
    }

    #searchInput:hover {
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      border-color: #c6c6c6;
    }

    #searchInput:focus {
      border-color: #0066FF;
      box-shadow: 0 6px 20px rgba(0,102,255,0.25);
      transform: translateY(-2px);
    }

    .search-icon {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: #9aa0a6;
      font-size: 1.2rem;
      z-index: 2;
    }

    .search-wrapper::before {
      content: "üîç";
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: #9aa0a6;
      font-size: 1.1rem;
      z-index: 2;
    }

    /* === INDICATEURS === */
    #status {
      margin: 15px 0;
      font-size: 1rem;
      color: #0066FF;
      font-weight: 500;
    }

    #resultCount {
      margin: 15px 0;
      font-size: 1.1rem;
      color: #0066FF;
      font-weight: 600;
      padding: 8px 20px;
      background: rgba(0,102,255,0.08);
      border-radius: 25px;
      display: inline-block;
    }

    /* === GRILLE DE R√âSULTATS - PLUS COMPACTE === */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      padding: 20px;
      max-width: 1300px;
      margin: 0 auto;
    }

    .result-card {
      background: white;
      border: 2px solid #e8f2ff;
      border-radius: 16px;
      padding: 20px;
      text-align: left;
      box-shadow: 0 4px 20px rgba(0,102,255,0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .result-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 12px 35px rgba(0,102,255,0.15);
      border-color: #0066FF;
    }

    .score-badge {
      position: absolute;
      top: -8px;
      right: 12px;
      background: linear-gradient(135deg, #0066FF, #0044CC);
      color: white;
      padding: 4px 12px;
      border-radius: 15px;
      font-weight: 600;
      font-size: 0.8rem;
      box-shadow: 0 3px 10px rgba(0,102,255,0.25);
    }

    .file-title {
      font-weight: 600;
      font-size: 1.1rem;
      color: #0066FF;
      margin-bottom: 10px;
      line-height: 1.3;
      padding-right: 60px;
    }

    .snippet {
      background: #f8fbff;
      padding: 14px;
      border-radius: 12px;
      margin: 12px 0;
      line-height: 1.5;
      font-size: 0.95rem;
      border-left: 3px solid #0066FF;
    }

    .highlight {
      background: linear-gradient(120deg, #ffeb3b, #ffc107);
      color: #000;
      font-weight: 600;
      padding: 1px 4px;
      border-radius: 3px;
    }

    .download-btn {
      background: linear-gradient(135deg, #0066FF, #0044CC);
      color: white;
      padding: 10px 25px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: 600;
      display: inline-block;
      margin-top: 10px;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      box-shadow: 0 4px 15px rgba(0,102,255,0.25);
    }

    .download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,102,255,0.4);
    }

    /* === INDICATEUR DE CHARGEMENT === */
    .loading {
      text-align: center;
      padding: 40px 20px;
      grid-column: 1 / -1;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #0066FF;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* === PAGINATION === */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 30px 0;
      padding: 0 20px;
    }

    .page-btn {
      padding: 8px 16px;
      background: white;
      border: 2px solid #0066FF;
      border-radius: 12px;
      color: #0066FF;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .page-btn:hover {
      background: #0066FF;
      color: white;
      transform: translateY(-1px);
    }

    .page-btn.active {
      background: #0066FF;
      color: white;
    }

    /* === MESSAGE D'ERREUR === */
    .error-message {
      grid-column: 1 / -1;
      text-align: center;
      padding: 30px 20px;
      background: white;
      border: 2px solid #ff4444;
      border-radius: 16px;
      margin: 20px;
    }

    .error-message h2 {
      color: #ff4444;
      margin-bottom: 10px;
      font-size: 1.3rem;
    }

    /* === RESPONSIVE === */
    @media (max-width: 768px) {
      .logo-text {
        font-size: 1.3rem;
      }
      
      .logo-container {
        padding: 8px 20px;
      }
      
      .logo-header {
        height: 30px;
      }
      
      .nav-container {
        margin: 10px 15px;
      }
      
      .bottom-nav a {
        padding: 10px 12px;
        font-size: 0.85rem;
      }
      
      .results-grid {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 15px;
      }
      
      #searchInput {
        font-size: 1rem;
        padding: 12px 45px;
      }
      
      .search-container h1 {
        font-size: 1.2rem;
      }
      
      .result-card {
        padding: 16px;
      }
    }

    /* === ANIMATIONS === */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-card {
      animation: fadeIn 0.4s ease-out;
    }
  </style>
</head>
<body>

  <!-- LOGO CENTR√â EN HAUT - PLUS COMPACT -->
  <div class="header-center">
    <div class="logo-container">
      <img src="logo.png" alt="Megane Learn" class="logo-header">
      <span class="logo-text">Megane Learn</span>
    </div>
  </div>

  <!-- BARRE DE NAVIGATION STYLIS√âE -->
  <div class="nav-container">
    <nav class="bottom-nav">
      <a href="index.html">ACCUEIL</a>
      <a href="rech.html" class="active">RECHERCHE</a>
      <a href="bt.html">PRO</a>
      <a href="gd.html">GUIDE</a>
    </nav>
  </div>

  <!-- ZONE DE RECHERCHE STYLE CHROME -->
  <div class="search-container">
    <h1>√âcrivez un mot cl√© pour voir les PDF disponibles</h1>
    <div class="search-wrapper">
      <input type="text" id="searchInput" placeholder="Ex : cours de math primitive, frein ABS, sch√©ma √©lectrique..." autofocus>
    </div>
    <div id="status">Chargement des PDF depuis searchfiles/...</div>
    <div id="resultCount"></div>
  </div>

  <!-- R√âSULTATS -->
  <div class="results-grid" id="results"></div>

  <!-- PAGINATION -->
  <div class="pagination" id="pagination" style="display: none;"></div>

  <script>
    // CONFIGURATION PDF.js
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.worker.min.js';
    }

    const RECH_FOLDER = "searchfiles";
    let allPDFs = [];
    let pdfCache = new Map();
    let searchTimeout;
    let currentPage = 1;
    const resultsPerPage = 12;
    let currentResults = [];

    // [Le reste du code JavaScript reste identique...]
    async function getPDFText(pdfName) {
      if (pdfCache.has(pdfName)) {
        return pdfCache.get(pdfName);
      }
      
      let fullText = "";
      try {
        if (typeof pdfjsLib === 'undefined') {
          console.error("PDF.js non charg√©");
          return "";
        }
        
        const loadingTask = pdfjsLib.getDocument(`https://raw.githubusercontent.com/ivanipote/PDF-search/main/${RECH_FOLDER}/${pdfName}`);
        const doc = await loadingTask.promise;
        
        for (let p = 1; p <= Math.min(doc.numPages, 10); p++) {
          const page = await doc.getPage(p);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(i => i.str).join(" ");
          fullText += pageText + " ";
        }
        pdfCache.set(pdfName, fullText);
      } catch (e) {
        console.error("Erreur analyse PDF:", pdfName, e);
      }
      return fullText;
    }

    function setupSearchDebounce() {
      document.getElementById("searchInput").addEventListener("input", (e) => {
        clearTimeout(searchTimeout);
        showLoading();
        
        searchTimeout = setTimeout(() => {
          const query = e.target.value.trim();
          if (query.length < 2) {
            showAllPDFs();
          } else {
            currentPage = 1;
            search(query);
          }
        }, 300);
      });
    }

    function showLoading() {
      document.getElementById("results").innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <p>Recherche en cours...</p>
        </div>
      `;
      document.getElementById("pagination").style.display = 'none';
    }

    function displayPaginatedResults(results) {
      const start = (currentPage - 1) * resultsPerPage;
      const end = start + resultsPerPage;
      const paginatedResults = results.slice(start, end);
      
      displayResults(paginatedResults);
      setupPagination(results.length);
    }

    function setupPagination(totalResults) {
      const totalPages = Math.ceil(totalResults / resultsPerPage);
      const paginationDiv = document.getElementById("pagination");
      
      if (totalPages <= 1) {
        paginationDiv.style.display = 'none';
        return;
      }
      
      paginationDiv.style.display = 'flex';
      paginationDiv.innerHTML = '';
      
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        btn.textContent = i;
        btn.onclick = () => {
          currentPage = i;
          displayPaginatedResults(currentResults);
        };
        paginationDiv.appendChild(btn);
      }
    }

    const synonymes = {
      "maths": ["math√©matiques", "calcul", "alg√®bre"],
      "electronique": ["circuit", "composant", "sch√©ma"],
      "physique": ["m√©canique", "optique", "thermodynamique"]
    };

    function expandQuery(query) {
      const terms = query.toLowerCase().split(/\s+/);
      const expanded = [...terms];
      terms.forEach(term => {
        if (synonymes[term]) {
          expanded.push(...synonymes[term]);
        }
      });
      return [...new Set(expanded)];
    }

    async function loadPDFList() {
      try {
        showLoading();
        const resp = await fetch(`https://api.github.com/repos/ivanipote/PDF-search/contents/${RECH_FOLDER}`);
        
        if (!resp.ok) {
          throw new Error(`Dossier introuvable: ${resp.status}`);
        }
        
        const files = await resp.json();
        allPDFs = files.filter(f => f.name.toLowerCase().endsWith('.pdf'));
        
        if (allPDFs.length === 0) {
          document.getElementById("status").textContent = "Dossier trouv√© mais aucun PDF d√©tect√©";
          showAllPDFs();
          return;
        }
        
        document.getElementById("status").textContent = `${allPDFs.length} PDF charg√©s - tapez pour rechercher`;
        showAllPDFs();
        
      } catch (e) {
        console.error("Erreur chargement:", e);
        document.getElementById("status").textContent = "‚ö†Ô∏è Cr√©ez le dossier 'searchfiles' sur GitHub";
        document.getElementById("results").innerHTML = `
          <div class="error-message">
            <h2>Dossier 'searchfiles' introuvable</h2>
            <p>Cr√©ez le dossier sur GitHub et ajoutez vos PDF dedans</p>
            <a href="https://github.com/ivanipote/PDF-search" style="color: #0066FF; text-decoration: none; font-weight: 600;">‚Üí Aller sur le d√©p√¥t GitHub</a>
          </div>
        `;
      }
    }

    function highlightText(text, terms) {
      let highlighted = text;
      terms.forEach(term => {
        const regex = new RegExp(`(${term})`, 'gi');
        highlighted = highlighted.replace(regex, '<span class="highlight">$1</span>');
      });
      return highlighted;
    }

    function calculateScore(pdfName, pdfText, terms) {
      let score = 0;
      const lowerName = pdfName.toLowerCase();
      const lowerText = pdfText.toLowerCase();
      
      terms.forEach(term => {
        if (lowerName.includes(term)) score += 3;
        const matches = (lowerText.match(new RegExp(term, 'gi')) || []).length;
        score += matches;
      });
      
      return score;
    }

    async function search(query) {
      const baseTerms = query.toLowerCase().split(/\s+/).filter(t => t.length > 1);
      const expandedTerms = expandQuery(query);
      
      let results = [];

      for (const pdf of allPDFs) {
        let snippet = "";
        let fullText = "";

        const nameMatchCount = baseTerms.filter(t => pdf.name.toLowerCase().includes(t)).length;

        try {
          fullText = await getPDFText(pdf.name);
          if (!snippet && fullText) {
            for (const term of baseTerms) {
              const index = fullText.toLowerCase().indexOf(term);
              if (index !== -1) {
                snippet = fullText.substring(Math.max(0, index - 50), index + 150) + "...";
                break;
              }
            }
          }
        } catch (e) {}

        const score = calculateScore(pdf.name, fullText, expandedTerms);
        if (score > 0 || nameMatchCount > 0) {
          results.push({
            pdf,
            score,
            snippet: snippet || "Correspondance dans le nom du fichier",
            terms: baseTerms
          });
        }
      }

      results.sort((a, b) => b.score - a.score);
      currentResults = results;
      displayPaginatedResults(results);
      
      document.getElementById("resultCount").textContent = 
        `${results.length} r√©sultat${results.length > 1 ? 's' : ''} intelligent${results.length > 1 ? 's' : ''}`;
    }

    function displayResults(results) {
      const grid = document.getElementById("results");
      grid.innerHTML = "";

      if (results.length === 0) {
        grid.innerHTML = `
          <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px; color: #666;">
            <h2 style="color: #0066FF;">Aucun r√©sultat trouv√©</h2>
            <p>Essayez avec d'autres mots-cl√©s ou v√©rifiez l'orthographe</p>
          </div>
        `;
        return;
      }

      results.forEach(item => {
        const rawUrl = `https://raw.githubusercontent.com/ivanipote/PDF-search/main/${RECH_FOLDER}/${item.pdf.name}`;
        const card = document.createElement("div");
        card.className = "result-card";
        card.innerHTML = `
          <div class="score-badge">Score ${item.score}</div>
          <div class="file-title">üìÑ ${item.pdf.name}</div>
          <div class="snippet">${highlightText(item.snippet, item.terms)}</div>
          <a href="${rawUrl}" download class="download-btn">T√©l√©charger le PDF</a>
        `;
        grid.appendChild(card);
      });
    }

    function showAllPDFs() {
      currentResults = allPDFs;
      displayPaginatedResults(allPDFs);
      document.getElementById("resultCount").textContent = `${allPDFs.length} PDF disponibles`;
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      setupSearchDebounce();
      loadPDFList();
    });
  </script>

  <script src="script.js"></script>
</body>
    </html>
